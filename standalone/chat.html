<html>  

<meta charset="utf-8" />
     <head>
       
		
<style>
.info{
top:0;
right:15px;
padding:100px;
  border-radius: 25px;
float:right;
 position: fixed;
background-color:white;
color:black;
width:150px;
height:150px;
text-align:center;
font-family: 'Josefin Sans', sans-serif;
font-weight: bolder;
}



/* Works on Firefox */
* {
  scrollbar-width: thin;
  scrollbar-color: black green;
}

/* Works on Chrome, Edge, and Safari */
*::-webkit-scrollbar {
  width: 20px;
}

*::-webkit-scrollbar-track {
  background: black;
}

*::-webkit-scrollbar-thumb {
  background-color: black;
  border-radius: 20px;
  border: 10px solid  green;
}
body{
 scrollbar-color: black green;   /* scroll thumb and track */ 
}
.msg{

	float:center;
	display: block;
	color:white;
	word-wrap: normal;
	padding:10px;
	border: 2px solid green;
	border-radius: 5px;
	width:90%;
	padding-top:10px;

}
.superMsg{
	display: block;
	color:red;
	font-weight:bolder;
	border: 2px solid black;
	border-radius: 5px;

}

.chat
{
	color:white;
	padding-left:100px;
	overflow-y:scroll;
	width:50%;height:75%; 
	font-size:30px;
	overflow-x:hidden;
	font-weight: bolder;
	overflow-anchor: bottom;
	float:center;
	border: 10px solid black;
	border-radius: 5px;
	
};
.imground{

  border-radius: 50%;

}

.gifts{
color:red;
float:center; 

}
body{
background-color:black; 

  }
  input,button{
  font-size:20px;
  color:white;
  width:200px;
  float:center;
  
  border-radius: 12px;
  background-color:green;
  text-align:center;
  
  }
  
  #myBtn {
  display: none;
  position: fixed;
  bottom: 20px;
  right: 30px;
  z-index: 99;
  font-size: 18px;
  border: none;
  outline: none;
  background-color: red;
  color: white;
  cursor: pointer;
  padding: 15px;
  border-radius: 4px;
}
img{
border-radius: 4px;
width:100px;
height:100px;

}
	#myBtn:hover {
	background-color: #555;
	}
  .chatwindow{
  
  display:none;
  margin-left: auto;
  margin-right: auto;
  
  }
  
  .introWindows{
  position:relative;
  
  
  color:red;
	top:50%;
	left:50%;
	
	right:50%;	
  width:300px;
  height:200px;
  border: 1px solid;
  padding: 10px;
  box-shadow: 5px 10px #888888;
  border-radius: 4px;
  }
  .img2{
  width:100px;
  height:100px;
  border-radius: 4px;
  }
</style>

<script src="https://js.pusher.com/2.2/pusher.min.js"> </script> 

<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>


</head>

<body> 

<!-- 
Thanks to  Jen, Wonk_wifi and Layliee  and mark_c and Lindalu 

//--> 
    
	</center>
<div  id ="startWindow" class="introWindows">
<center>
<button onclick=displayStickers();  style="height:100px;height:40px" >Display Stickers</button>
<br>
<h2>Please type in user id</h2>
<br>
<input type="text" id="userInputId" value=2282276  />
<br>
<button onclick="displayChat();" >Sign in </button>
<br>
</center>

</div>
<script>
var totalLikes =0; 
var stickers = true; 


	function displayStickers(){

	stickers = !stickers
	if(stickers!=true){
	alert("stickers are off"); 
	}
	else{
	alert("stickers are On"); 
	}
	}

function displayChat(){

var inputId= document.getElementById("userInputId").value;
var chatWin = document.getElementById("chatWindow");
var startWin = document.getElementById("startWindow");
if(inputId >0){

//
chatWin.style.display = 'block'; 
startWin.style.display='none';

FetchEvent(inputId);


}

}

</script> 
<div class="chatwindow" id="chatWindow">
  <div id="chat" class="chat" style="color:green;">
<script>
<!-- 

var OnorOff= false; 

function goDown(){
		
		if(OnorOff !=true){
		window.setInterval(function() {
		var elem = document.getElementById('chat');
		elem.scrollTop = elem.scrollHeight;
		}, 5000);

		OnorOff= true; 

						}
		else{

	OnorOff = false; 
	alert("off");

			}
}

//-->

</script>
	</div>  


	
    <script>
// start of spotify  work  



function get_current_song(){
	// https://developer.spotify.com/console/get-users-currently-playing-track/?market=&additional_types=

	var url = "https://api.spotify.com/v1/me/player/currently-playing";
	var xhr = new XMLHttpRequest();
	
	xhr.open("GET", url);
	xhr.setRequestHeader("Accept", "application/json");
	xhr.setRequestHeader("Content-Type", "application/json");
	xhr.setRequestHeader("Authorization", "Bearer  BQBDCZiHhtjqhUI94cNaeoN1FBd4hTcbsDHIGbIcz7vt1xlZHKA6vYmKhRf_LzOJx_OLmd8Z8pgfAnoFGj4gLBOrKspheF6-l9rSugTcJniQ2AZ_ph88ir9xAndOuU3PZEFmhAziMvozzg0er-2YdrYPuuNG9olc3-jtegKlFrBwhXAqIBmw-C2jujQ8PaG9MfF7");


		xhr.onreadystatechange = function () {
				if (xhr.readyState === 4) {
					convertToJSON(xhr.responseText); 
	 
				}};

				xhr.send();


	
}


function cleanUp(dirtytext){

var i =0; 

let text = dirtytext;
let cleanText = text.replace(/covid|virus|overweight|ugly|facebook|feet/gi, "**** "); 




return cleanText;

}


function getprev(){

var url2 ="https://api.spotify.com/v1/me/player/recently-played?limit=1" 
//https://developer.spotify.com/console/get-recently-played/?limit=&after=&before=

var xhr = new XMLHttpRequest();
xhr.open("GET", url2);

xhr.setRequestHeader("Accept", "application/json");
xhr.setRequestHeader("Content-Type", "application/json");
xhr.setRequestHeader("Authorization", "Bearer  BQBlqmt44NOqJsyPFwr8N3ynP9mldzWaaYvFPlVk9lTdDclYAOGrL_efooydFJ_M8VUjgtB-cxR8pV6QFgLBKDyDt7TzM4YtKfJE8TwRTrD7rKhwVQn5Fjwl-UHtJN21RthBQ4-me5ldG8nq3buJUDolDQmTxPI9h7lyhAa-lMoqDJ1_z7KCq4asKvHNFx0YTHMC");


xhr.onreadystatechange = function () {
   if (xhr.readyState === 4) {
		
	toJSon(xhr.responseText);
	  
	  
   }};

xhr.send();



}
/*
window.setInterval(function(){
getprev();
},60000);

*/




function toJSon(data3){


	const stuff=JSON.parse(data3);
	var outputs = stuff

	var nameOfLastPlayed=outputs.items[0].track.name
	var thumbnail =  "<img src='"+outputs.items[0].track.album.images[0].url + "' style=width:200px;height:200px;border-radius:25px;>";
	document.getElementById('info').innerHTML  = "<span style='font-size:20px;color:black;'>" + nameOfLastPlayed + "<br>" + thumbnail + "<br>";

}






// chat log below work

var goodies = null; 

DownloadGifts();

function customUserName(){


}
function displayGiftOnly(i,data2){
	
	index =0; 
	var index =0; 
	stuff = goodies.goodies;
	gifts = data2; 
	
	var totalLikesGiven = gifts.extraData['numOfLikes']
	
	if(totalLikesGiven> 1)
	{
	
	return totalLikesGiven
	}
	else if (gifts.extraData.value > 1){
	
	
	return gifts.extraData.value;
	
	}
	else{
	
	
	return 0
	}
} 

	async function DownloadGifts()
	{
    //console.log ("Fetching Gifts...");
    targetUrl = 'https://ynassets.younow.com/giftsData/live/de/data.json';
    var json = fetch (targetUrl)
        .then (blob => blob.json ())
        .then (data =>
        {
            json = JSON.stringify (data, null, 2);
            goodies = JSON.parse (json);
        });
	}

 
	function FetchEvent (userId){
		pusher = new Pusher ('d5b7447226fc2cd78dbb', {
        cluster: "younow"
		});
	
		let channel = pusher.subscribe ("public-channel_" + userId);
  
		channel.bind('onEnd', function(data){

		});
	
	channel.bind ('onChat', function (data)
    {
		
        if (data.message !== "undefined")
    
			{
				var dataout = "" ; 
					for (let i = 0; i < data.message.comments.length; i++)
						{
						var username = data.message.comments[i].name;
						var	TimsStamp =  data.message.comments[i].timestamp; 
						var whatsSaid = cleanUp(data.message.comments[i].comment); 
						var CommentUserId = data.message.comments[i].userId; 
						var userImage = GetuserImage(CommentUserId); 
						var propslevel = (data.message.comments[i].propsLevel ) 
						var ifMod = data.message.comments[i].broadcasterMod; 
						;
				
			if(ifMod != false) {
			
			
						dataout = dataout + "<table><tr><td>"+"<img  style='width:50px;height:50px; border-radius: 20px;align:left;' src='" + userImage+"'/></td><td  class='msg' style='color:red;background-color:white'>" + Math.abs(propslevel) + " " +data.message.comments[i].name  +" "+ timeConverter(TimsStamp) +"<br>"  +cleanUp(data.message.comments[i].comment) + 
						"</td></tr><table>"; 
			}
			else{
						dataout = dataout + "<table><tr><td>"+"<img  style='width:50px;height:50px; border-radius: 20px;align:left;' src='" + userImage+"'/></td><td  class='msg' style='color:white'>" + Math.abs(propslevel) + " " +data.message.comments[i].name  +" "+ timeConverter(TimsStamp) +"<br>"  +cleanUp(data.message.comments[i].comment) + 
						"</td></tr><table>"; 
			}
			//console.log(data.message.comments[i].broadcasterMod ); 
			

						}
	
			}



		displayIt(dataout); 



	
	});

	
   
        channel.bind('onGift', function (data)
        {
		
		let tempUsername = data.message.stageGifts[0].profileUrlString
		var giftids = data.message.stageGifts[0].giftId;
		var onlydata = data.message.stageGifts[0];
		
		if(displayGiftOnly(giftids,onlydata) != 0){
		
		dataout = "<div  class='msg' style='font-size:16px;'>" +tempUsername+ " Gave <center> "+ displayGiftOnly(giftids,onlydata)+" likes </center></div>"
		}
		else{
		dataout = "<div  class='msg' style='font-size:16px;'><center>" + onlydata.comment+"  </center></div>"
		
		
		}
		displayIt(dataout)
  
		
		});
	
        //Get Stickers
        channel.bind('onSticker', function (data)
        {
		if(stickers !=false) {
		dealwithFreeStickers(data);
		}
		else{
		
		}
		  //  console.log('sticker data', data);
            //handleNewSticker(data);
        });

	channel.bind('onRaid', function (data)
        {
		console.log("raid : " +  data )
		
		});





        //Get Stickers
        channel.bind('onPartnerSticker', function (data)
        {
		
		console.log("Partener sticker data " + data )
            //handleOnOldPartnerSticker(data);
        });
   
			
   
		channel.bind ('onSuperMessage', function (data)
			{        
		

			dataout = dataout + "<div class='msg' style='color:red'>"    +data.message.superMessages[0].name +" <b> " + data.message.superMessages[0].comment + "</b><div>"; 
		
			displayIt(dataout);
			
		//	
		});
		
	
	
	
}  
function dealwithFreeStickers(data){

	var ids = data.message.stickers[0].stickerUserId; 
	var stickername = data.message.stickers[0].assetSku; 
	var fullpath = "https://ynassets.younow.com/subscriptionsTiers/usersAssets/live/" + ids+"/" +stickername +"/web_" +stickername +".png?assetRevision=1 " ;
	var sent_user = data.message.stickers[0].profile;
  var imagedata= "<div class='msg'    style='width:200px;height:auto;font-size:15px;' >" +sent_user+"  <br><img src='" + fullpath +"' style='color:white; width:50px;height:50px'/> </div>"

	displayIt(imagedata); 
 

}
function GetuserImage(data){


return   "https://ynassets.younow.com/user/live/" + data + "/" + data +".jpg"; 



}
function timeConverter(UNIX_timestamp){
  var a = new Date(UNIX_timestamp * 1000);
  var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  var year = a.getFullYear();
  var month = months[a.getMonth()];
  var date = a.getDate();
  var hour = a.getHours();
  var min = a.getMinutes();
  var sec = a.getSeconds();
  if(sec <10 ){
	sec ="0"+sec

  }
  if(hour <10) {
	hour = "0" + hour;

  }
  if(min <10){
	min = "0" + min

  }
  var time =   hour + ':' + min ;
  return time;
}
function displayIt(data){

	dataout = data;
	var el2 =   document.getElementById("chat") ;
	el2.innerHTML =   el2.innerHTML  + dataout; 

}

</script> <button onclick="gotoTop()" id="myBtn" title="Go to top">Top</button>

   <script><!-- 
function gotoTop()
{
	var el3 =   document.getElementById("chat") ;
	el3.scrollTop =0; 

}

var mybutton = document.getElementById("myBtn");
var el3 =   document.getElementById("chat") ;

el3.onscroll = function() {scrollFunction()};

	function scrollFunction() {
		if (el3.scrollTop>2 ) {
			mybutton.style.display = "block";
		} else {
			mybutton.style.display = "none";
  }
}

  //--></script>
<br/>

<button onclick="goDown();" style='align:left;'>AutoScroll (On/Off)</button>

</div>
<div id="countDown" style="right:0;text-align:right;font-size:40px;">

</div>
<div id="info" class="info">

</div> 
</body>
	</html>
